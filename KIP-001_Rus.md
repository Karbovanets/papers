
# KIP-001: ArgoNight — Неподлежащий аутсорсингу алгоритм хеширования и доказательства работы с доступом к блокчейну

в. 1.1

nuclEar_chaos, [Aiwe](https://github.com/aivve), [Luke](https://github.com/ClashLuke)

Здесь описывается предложение нового алгоритма доказательства работы для Карбованца.

## Причина

Одним из краеугольных камней протокола CryptoNote и Карбованца является *"эгалитарный proof of work" *(с англ. "Доказательство работы"), который был разрушен изобретением специализированных устройств для майнинга т. н. ASIC-ов под алгоритм CryptoNight, используемый в CryptoNote. Карбованец до сих пор использует этот алгоритм несмотря на то, что большинство монет основанных на протоколе CryptoNote изменили его на свои варианты и модификации различной сложности под идейным предводительством Monero (в основном варианты Monero и используются).

Причиной этого является желание сохранения как можно большей децентрализации майнинга, потому что сосредоточение большинства мощностей в одних руках нескольких производителей ASIC-ов в общем  считается опасным для монет.

Другой причиной является попытка изменить алгоритм на уникальный для данной монеты если она сравнительно мала чтобы избежать возможности аренды мощностей на сервисах типа Nicehash.

Общий алгоритм большей монетой представляет опасность для меньшей монеты потому что возникает риск атак 51% с использованием арендованных мощностей или риск нашествий майнеров которые перескакивают с монеты на монету в поисках большей выгоды вызывая флуктуации сложности и временных интервалов между блоками.

В Карбо мы пришли к выводу что мелкие изменения в алгоритме хеширования недостаточны, что и подтверждают частые хардфоркы сети Monero в попытках убежать от ASIC-ов и вновь сделанных FPGA под их варианты. Мы считаем, что как только это становится экономически привлекательным, ASIC-и будут сделаны для любого алгоритма. Существует только несколько таких, которые считаются ASIC-устойчивыми.

Поэтому мы медлили с подобным изменением алгоритма и не перешли ни на один из вариантов CryptoNight разработанных Monero или другими монетами (хотя и адаптировали некоторые) пока не разработаем свой усовершенствованный алгоритм, который будет не только устойчивым к ASIC-ам, но также будет отдавать предпочтение соло майнингу, что является действительно децентрализованным майнингом, без пулов, а также будет устойчивым к ботнетам.


## Общий обзор

Для того чтобы достичь нашей цели, было решено использовать данные из блокчейна чтобы создать такой алгоритм, в котором хеширования нельзя передать третьей стороне таким образом предотвращая майнинг в пулах и ботнеты.

До сих пор хеширование было замкнутым алгоритмом, то есть имелся переменный т. н. `nonce` и входные статические данные блока. Идея заключается в том, чтобы в вычисления финального хеша включить фактор который такую замкнутую систему разрушает. В конкретной имплементации предлагается включить в алгоритм данные из блоков, высота которых определяется как промежуточный результат подготовительного хеширования. То есть для последующего хеша с другим `нонсом` эти промежуточные блоки будут совсем другими. Таким образом без доступа к блокчейну хеширования невозможно.


## Детальный обзор

Хеширование в предлагаемом алгоритме работает следующим образом:

1) Блок `block` хешируется быстрым алгоритмом Keccak для получения предварительного хеша `hash_1`.

2) Результат `hash_1`используется для получения из блокчейна тридцати двух блоков на соответствующих высотах.

3) Дальше `block` еще раз хешируется вместе с тридцати двумя полученными блоками с помощью алгоритма хеширования Argon2 с использованием `hash_1` в качестве соли.

Термин `block` здесь означает двоичный массив "block hashing blob", который содержит заголовок блока, в свою очередь, содержащий, среди прочего, т. н. `nonce`.

Процесс майнинга в системах Proof-of-Work использует `nonce` ("нонс", 32-битное случайное число) вместе с данными блока в качестве входных данных для функции хеширования. В общем, майнер просто перебирает все возможные "нонсы" пока не найдет такой, который в результате даст хэш который удовлетворяет текущую целевую сложность.

Поскольку изменение `nonce` влечет за собой изменение результирующего `hash_1`, другой набор 32 блоков нужен для **каждого** следующего `nonce`, которые надо извлечь из блокчейна. Благодаря этому:

* эффективность ограничена скоростью операций ввода/вывода
* каждый майенер должен иметь доступ к блокчейну (то есть быть полным узлом сети)
* передача с сервера пула или запросы данных блоков из открытых узлов сети нецелесообразны из-за задержек и ограничения скорости/пропускной способности.

В результате, по нашему мнению, *майнинг в пулах* при таком алгоритме является сложным для воплощения, а также такой алгоритм будет *устойчивым к ботнетам*.

## Примечания

Мы не нацеливаемся специально для майнинг только на CPU и не имеем цели полностью исключить майнинг на GPU, хотя Argon2 создает определенные ограничения для GPU.

Мы предполагаем что ограничения быстродействия операций ввода/вывода ограничат также скорость ASIC- и FPGA-майнеров, если таковые будут созданы.

В протоколе CryptoNote нет узлов SPV, поэтому необходимость доступа к полному блокчейну для верификации блоков не является препятствием для этого алгоритма.

Его преимущества достигаются за счет скорости синхронизации - узлы должны синхронизироваться блок за блоком в порядке возрастания, потому что предыдущие блоки необходимые для верификации последующих, но это настоящий способ синхронизации Карбованца поэтому ничего не замедляется.

Есть опасения создания «легкого» майнера, что разбирает и хранит только заголовки блоков, необходимые для майнинга вместо полного блокчейна. Впрочем, целесообразность (учитывая издержки создания) и преимущества такого майнера кажутся сомнительными.

